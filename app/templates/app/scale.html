{% extends "base_two.html" %}
{% load static %}

{% block body %}

    <div class="frame">
        <div id="slider" class="rslider"></div>
        <div class="thermostat">
            <div class="ring">
                <div class="bottom_overlay"></div>
            </div>
            <div class="control">
                <div class="temp_outside">0</div>
                <div class="temp_right">10</div>
                <!-- <div class="room">Number</div> -->
            </div>
        </div>
        <div class="instructions">
            <h4>Drag the handle, click at the number you want, or directly type your number in <i class="fas fa-heart"></i></h4>
        </div>

        {{ game_id|json_script:'json-game-id' }}
        {{ player.username|json_script:'json-username' }}
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>                            
    <script src="https://cdnjs.cloudflare.com/ajax/libs/roundSlider/1.6.1/roundslider.min.js" integrity="sha512-OztPUuNsmM+BUn6NOM5EVZED6aFf/0P4V+cVwcf5iR5T58hGyIJ8XtWFd5ctuOpGytfCsxy4/9JqxeTLliXrBA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        const gameID = JSON.parse(document.getElementById('json-game-id').textContent);
        const userName = JSON.parse(document.getElementById('json-username').textContent);

        document.addEventListener('DOMContentLoaded', () => {
            const sessionSocket = new WebSocket(
                'ws://'
                + window.location.host
                + '/ws/game_session/'
                + gameID
            );
        
            sessionSocket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                if (data.message == "value change") {
                    $("#slider").data("roundSlider").setValue(data.value) 
                }
            };

            $("#slider").roundSlider({
                    radius: 75,
                    circleShape: "half-top",
                sliderType: "min-range",
                    mouseScrollAction: true,
                value: 20,
                    handleSize: "+5",
                    min: 0,
                    max: 40,   
                
                drag: function (e) {
                    var sliderValue = $("#slider").data("roundSlider").getValue()
                
                    message="value change"
                    sessionSocket.send(JSON.stringify({
                        'message': message,
                        'username': userName,
                        'room': gameID,
                        'value': sliderValue,
                    }));
                } //end of valueChange
            }); //eof

        }); //event close  

    </script>

{% endblock %}
